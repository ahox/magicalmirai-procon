import P5 from "p5";
import { Player, Ease } from "textalive-app-api";
//import '@fortawesome/fontawesome-free/js/all.js'
import images from './img/*.png'
import fontawesomes from '../node_modules/@fortawesome/fontawesome-free/svgs/solid/*.svg'


// プレイヤーの初期化 / Initialize TextAlive Player
const player = new Player({
	app: {
		appAuthor: "あほくす（まじりみ）@friends.cafe",
		appName: "マジカルミライプログラミングコンテスト",
	},
	mediaElement: document.querySelector("#media"),
	valenceArousalEnabled: true,
	vocalAmplitudeEnabled: true,
});

// 各種設定
const myenv = {
	// 楽曲選択
	selectSong: "Greenlights Serenade",
	// selectSong: "Bless Your Breath";
	// selectSong: "Ai Sarenakutemo Kimi Ga Iru";
	
	// 演出設定
	templateMap: [
		{ indexType: "beat", startIndex: 0, endIndex: 20, 
			backgroundType: "default", bgColorHSB: [84,37,54],
			templateType: "default" },
		{ indexType: "beat", startIndex: 20, endIndex: 64,
			backgroundType: "default", bgColorHSB: [84,37,54], bgBeatAmpS: 20,
			templateType: "default" },
		{ indexType: "beat", startIndex: 64, endIndex: 80,
			backgroundType: "wave", bgColorHSB: [84,37,54], bgWaveCount: 120, bgWaveColorHSB: [84,37,64],
			templateType: "default" },
		{ indexType: "beat", startIndex: 80, endIndex: 96,
			backgroundType: "warp", bgColorHSB: [140,240,41], bgWarpObjType: "point", bgWarpObjColorHSB: [140,240,240],
			bgWarpObjCurve: [
				[{x: -0.630768640964528, y: 1.05644490476937, w:8.38325842213147, t: 0.585283938475239},{x: -0.630768640964528, y: 1.05644490476937, w:8.38325842213147, t: 0.585283938475239},{x: 0.273846271807094, y: 0.611288980953874, w:0, t: 0.785283938475239},{x: 0.273846271807094, y: 0.611288980953874, w:0, t: 0.785283938475239},],
				[{x: 1.67525840581274, y: 0.822666323734368, w:9.13472804497598, t: 0.343146699148862},{x: 1.67525840581274, y: 0.822666323734368, w:9.13472804497598, t: 0.343146699148862},{x: 0.735051681162548, y: 0.564533264746874, w:0, t: 0.543146699148862},{x: 0.735051681162548, y: 0.564533264746874, w:0, t: 0.543146699148862},],
				[{x: -0.317549474310684, y: -0.695873290801981, w:9.43179217713843, t: 0.505686312905563},{x: -0.317549474310684, y: -0.695873290801981, w:9.43179217713843, t: 0.505686312905563},{x: 0.336490105137863, y: 0.260825341839604, w:0, t: 0.705686312905563},{x: 0.336490105137863, y: 0.260825341839604, w:0, t: 0.705686312905563},],
				[{x: 1.39655771704468, y: 1.95634689368016, w:8.81132192708152, t: 0.228013821492276},{x: 1.39655771704468, y: 1.95634689368016, w:8.81132192708152, t: 0.228013821492276},{x: 0.679311543408937, y: 0.791269378736033, w:0, t: 0.428013821492276},{x: 0.679311543408937, y: 0.791269378736033, w:0, t: 0.428013821492276},],
				[{x: -0.71707920317965, y: 1.20708766133608, w:7.68087902097658, t: 0.319150696092546},{x: -0.71707920317965, y: 1.20708766133608, w:7.68087902097658, t: 0.319150696092546},{x: 0.25658415936407, y: 0.641417532267217, w:0, t: 0.519150696092546},{x: 0.25658415936407, y: 0.641417532267217, w:0, t: 0.519150696092546},],
				[{x: 1.06835389316527, y: 1.29496328500471, w:5.15087499603878, t: 0.420081076848351},{x: 1.06835389316527, y: 1.29496328500471, w:5.15087499603878, t: 0.420081076848351},{x: 0.613670778633054, y: 0.658992657000942, w:0, t: 0.620081076848351},{x: 0.613670778633054, y: 0.658992657000942, w:0, t: 0.620081076848351},],
				[{x: 0.457422504309071, y: -0.202097865940551, w:8.63711594063264, t: 0.78273849035549},{x: 0.457422504309071, y: -0.202097865940551, w:8.63711594063264, t: 0.78273849035549},{x: 0.491484500861814, y: 0.35958042681189, w:0, t: 0.98273849035549},{x: 0.491484500861814, y: 0.35958042681189, w:0, t: 0.98273849035549},],
				[{x: 0.218653922560691, y: 1.82940137931506, w:8.32817100311574, t: 0.421117234803019},{x: 0.218653922560691, y: 1.82940137931506, w:8.32817100311574, t: 0.421117234803019},{x: 0.443730784512138, y: 0.765880275863012, w:0, t: 0.621117234803019},{x: 0.443730784512138, y: 0.765880275863012, w:0, t: 0.621117234803019},],
				[{x: -0.390020495416864, y: 0.543125803852804, w:9.81002412105518, t: 0.682873693105551},{x: -0.390020495416864, y: 0.543125803852804, w:9.81002412105518, t: 0.682873693105551},{x: 0.321995900916627, y: 0.508625160770561, w:0, t: 0.882873693105551},{x: 0.321995900916627, y: 0.508625160770561, w:0, t: 0.882873693105551},],
				[{x: 1.31666359007214, y: 1.15727301987902, w:5.46215035381224, t: 0.272854795846271},{x: 1.31666359007214, y: 1.15727301987902, w:5.46215035381224, t: 0.272854795846271},{x: 0.663332718014428, y: 0.631454603975804, w:0, t: 0.472854795846271},{x: 0.663332718014428, y: 0.631454603975804, w:0, t: 0.472854795846271},],
				[{x: 0.483551186307397, y: -0.493912206771723, w:7.89692068756646, t: 0.581249028973123},{x: 0.483551186307397, y: -0.493912206771723, w:7.89692068756646, t: 0.581249028973123},{x: 0.496710237261479, y: 0.301217558645655, w:0, t: 0.781249028973124},{x: 0.496710237261479, y: 0.301217558645655, w:0, t: 0.781249028973124},],
				[{x: 1.22676960957287, y: 1.5306401004679, w:5.12819892367849, t: 0.0225621390838197},{x: 1.22676960957287, y: 1.5306401004679, w:5.12819892367849, t: 0.0225621390838197},{x: 0.645353921914574, y: 0.706128020093579, w:0, t: 0.22256213908382},{x: 0.645353921914574, y: 0.706128020093579, w:0, t: 0.22256213908382},],
				[{x: -0.264486414729708, y: -0.0464934281893212, w:6.11930415039468, t: 0.123182924033935},{x: -0.264486414729708, y: -0.0464934281893212, w:6.11930415039468, t: 0.123182924033935},{x: 0.347102717054058, y: 0.390701314362136, w:0, t: 0.323182924033935},{x: 0.347102717054058, y: 0.390701314362136, w:0, t: 0.323182924033935},],
				[{x: 1.69673388359083, y: 0.660035799893202, w:6.85116182499095, t: 0.455677722227096},{x: 1.69673388359083, y: 0.660035799893202, w:6.85116182499095, t: 0.455677722227096},{x: 0.739346776718166, y: 0.53200715997864, w:0, t: 0.655677722227096},{x: 0.739346776718166, y: 0.53200715997864, w:0, t: 0.655677722227096},],
				[{x: 0.0303003710396348, y: -0.833480952074955, w:5.40834117400991, t: 0.414006193239538},{x: 0.0303003710396348, y: -0.833480952074955, w:5.40834117400991, t: 0.414006193239538},{x: 0.406060074207927, y: 0.233303809585009, w:0, t: 0.614006193239538},{x: 0.406060074207927, y: 0.233303809585009, w:0, t: 0.614006193239538},],
				[{x: -0.177700045363824, y: 1.60679530859583, w:8.45417566290963, t: 0.792423633385472},{x: -0.177700045363824, y: 1.60679530859583, w:8.45417566290963, t: 0.792423633385472},{x: 0.364459990927235, y: 0.721359061719166, w:0, t: 0.992423633385472},{x: 0.364459990927235, y: 0.721359061719166, w:0, t: 0.992423633385472},],
				[{x: -0.748063116483812, y: -0.325390395512982, w:5.94631022032989, t: 0.147249803970516},{x: -0.748063116483812, y: -0.325390395512982, w:5.94631022032989, t: 0.147249803970516},{x: 0.250387376703238, y: 0.334921920897404, w:0, t: 0.347249803970516},{x: 0.250387376703238, y: 0.334921920897404, w:0, t: 0.347249803970516},],
				[{x: 1.09255782240156, y: 0.21512676265751, w:5.37327608979767, t: 0.379643360982681},{x: 1.09255782240156, y: 0.21512676265751, w:5.37327608979767, t: 0.379643360982681},{x: 0.618511564480313, y: 0.443025352531502, w:0, t: 0.579643360982681},{x: 0.618511564480313, y: 0.443025352531502, w:0, t: 0.579643360982681},],
				[{x: 0.678749697034251, y: -0.441276025804248, w:9.65899682181044, t: 0.408494678147033},{x: 0.678749697034251, y: -0.441276025804248, w:9.65899682181044, t: 0.408494678147033},{x: 0.53574993940685, y: 0.31174479483915, w:0, t: 0.608494678147033},{x: 0.53574993940685, y: 0.31174479483915, w:0, t: 0.608494678147033},],
				[{x: -0.349868673934814, y: 1.03725390097013, w:5.39749734792048, t: 0.684872726969178},{x: -0.349868673934814, y: 1.03725390097013, w:5.39749734792048, t: 0.684872726969178},{x: 0.330026265213037, y: 0.607450780194025, w:0, t: 0.884872726969178},{x: 0.330026265213037, y: 0.607450780194025, w:0, t: 0.884872726969178},],
				[{x: -0.183340236049287, y: -0.469308053455087, w:5.31034547273406, t: 0.777286906248654},{x: -0.183340236049287, y: -0.469308053455087, w:5.31034547273406, t: 0.777286906248654},{x: 0.363331952790143, y: 0.306138389308983, w:0, t: 0.977286906248654},{x: 0.363331952790143, y: 0.306138389308983, w:0, t: 0.977286906248654},],
				[{x: 1.96392218667248, y: 0.733181316304661, w:7.44973505905669, t: 0.449137567749462},{x: 1.96392218667248, y: 0.733181316304661, w:7.44973505905669, t: 0.449137567749462},{x: 0.792784437334497, y: 0.546636263260932, w:0, t: 0.649137567749462},{x: 0.792784437334497, y: 0.546636263260932, w:0, t: 0.649137567749462},],
				[{x: 0.597382396210742, y: -0.631284515248441, w:8.43109624898278, t: 0.38447273593749},{x: 0.597382396210742, y: -0.631284515248441, w:8.43109624898278, t: 0.38447273593749},{x: 0.519476479242148, y: 0.273743096950312, w:0, t: 0.584472735937489},{x: 0.519476479242148, y: 0.273743096950312, w:0, t: 0.584472735937489},],
				[{x: -0.209499171455762, y: 1.0351603635827, w:7.70788358613547, t: 0.455443191602948},{x: -0.209499171455762, y: 1.0351603635827, w:7.70788358613547, t: 0.455443191602948},{x: 0.358100165708848, y: 0.60703207271654, w:0, t: 0.655443191602948},{x: 0.358100165708848, y: 0.60703207271654, w:0, t: 0.655443191602948},],
				[{x: -0.511977340103412, y: 1.12158559108136, w:7.54764023702388, t: 0.36558224267069},{x: -0.511977340103412, y: 1.12158559108136, w:7.54764023702388, t: 0.36558224267069},{x: 0.297604531979318, y: 0.624317118216271, w:0, t: 0.56558224267069},{x: 0.297604531979318, y: 0.624317118216271, w:0, t: 0.56558224267069},],
				[{x: 1.54297269719015, y: 1.13599536926955, w:5.57409737127017, t: 0.225053164726678},{x: 1.54297269719015, y: 1.13599536926955, w:5.57409737127017, t: 0.225053164726678},{x: 0.70859453943803, y: 0.62719907385391, w:0, t: 0.425053164726678},{x: 0.70859453943803, y: 0.62719907385391, w:0, t: 0.425053164726678},],
				[{x: 0.921303342122201, y: -0.304026061444846, w:8.08165117452263, t: 0.700038679936034},{x: 0.921303342122201, y: -0.304026061444846, w:8.08165117452263, t: 0.700038679936034},{x: 0.58426066842444, y: 0.339194787711031, w:0, t: 0.900038679936034},{x: 0.58426066842444, y: 0.339194787711031, w:0, t: 0.900038679936034},],
				[{x: -0.137929483735194, y: 1.26714486660618, w:8.52824925586866, t: 0.494994982464267},{x: -0.137929483735194, y: 1.26714486660618, w:8.52824925586866, t: 0.494994982464267},{x: 0.372414103252961, y: 0.653428973321236, w:0, t: 0.694994982464267},{x: 0.372414103252961, y: 0.653428973321236, w:0, t: 0.694994982464267},],
				[{x: -0.763104643926782, y: -0.229264553912486, w:9.62084529885808, t: 0.651206515000801},{x: -0.763104643926782, y: -0.229264553912486, w:9.62084529885808, t: 0.651206515000801},{x: 0.247379071214644, y: 0.354147089217503, w:0, t: 0.851206515000801},{x: 0.247379071214644, y: 0.354147089217503, w:0, t: 0.851206515000801},],
				[{x: 1.97705556416422, y: -0.369050305130811, w:6.33340726899906, t: 0.365310783714277},{x: 1.97705556416422, y: -0.369050305130811, w:6.33340726899906, t: 0.365310783714277},{x: 0.795411112832845, y: 0.326189938973838, w:0, t: 0.565310783714277},{x: 0.795411112832845, y: 0.326189938973838, w:0, t: 0.565310783714277},],
				[{x: 0.646256105092745, y: -0.286454802196477, w:6.68741618911127, t: 0.508099326459887},{x: 0.646256105092745, y: -0.286454802196477, w:6.68741618911127, t: 0.508099326459887},{x: 0.529251221018549, y: 0.342709039560705, w:0, t: 0.708099326459887},{x: 0.529251221018549, y: 0.342709039560705, w:0, t: 0.708099326459887},],
				[{x: 1.14581675106989, y: 1.5251580409967, w:8.98309109330461, t: 0.722199698466058},{x: 1.14581675106989, y: 1.5251580409967, w:8.98309109330461, t: 0.722199698466058},{x: 0.629163350213977, y: 0.70503160819934, w:0, t: 0.922199698466058},{x: 0.629163350213977, y: 0.70503160819934, w:0, t: 0.922199698466058},],
				[{x: -0.696294882747747, y: -0.00109817219588093, w:9.26785348535251, t: 0.631266101219799},{x: -0.696294882747747, y: -0.00109817219588093, w:9.26785348535251, t: 0.631266101219799},{x: 0.260741023450451, y: 0.399780365560824, w:0, t: 0.831266101219799},{x: 0.260741023450451, y: 0.399780365560824, w:0, t: 0.831266101219799},],
				[{x: 1.18504384280353, y: 0.100836131702503, w:9.33587185448683, t: 0.294678823922639},{x: 1.18504384280353, y: 0.100836131702503, w:9.33587185448683, t: 0.294678823922639},{x: 0.637008768560706, y: 0.420167226340501, w:0, t: 0.494678823922639},{x: 0.637008768560706, y: 0.420167226340501, w:0, t: 0.494678823922639},],
				[{x: 0.423561180115867, y: -0.292639226824764, w:5.68661573716478, t: 0.277922430616772},{x: 0.423561180115867, y: -0.292639226824764, w:5.68661573716478, t: 0.277922430616772},{x: 0.484712236023173, y: 0.341472154635047, w:0, t: 0.477922430616772},{x: 0.484712236023173, y: 0.341472154635047, w:0, t: 0.477922430616772},],
				[{x: -0.288309674962092, y: 1.19871975666522, w:9.05594809444416, t: 0.499417332916596},{x: -0.288309674962092, y: 1.19871975666522, w:9.05594809444416, t: 0.499417332916596},{x: 0.342338065007582, y: 0.639743951333044, w:0, t: 0.699417332916596},{x: 0.342338065007582, y: 0.639743951333044, w:0, t: 0.699417332916596},],
				[{x: -0.779641036009099, y: 1.1660529746594, w:6.51912908356676, t: 0.239611820186211},{x: -0.779641036009099, y: 1.1660529746594, w:6.51912908356676, t: 0.239611820186211},{x: 0.24407179279818, y: 0.63321059493188, w:0, t: 0.439611820186211},{x: 0.24407179279818, y: 0.63321059493188, w:0, t: 0.439611820186211},],
				[{x: 1.51023361049554, y: 0.518413911731196, w:8.24924701761755, t: 0.707730697077872},{x: 1.51023361049554, y: 0.518413911731196, w:8.24924701761755, t: 0.707730697077872},{x: 0.702046722099107, y: 0.503682782346239, w:0, t: 0.907730697077872},{x: 0.702046722099107, y: 0.503682782346239, w:0, t: 0.907730697077872},],
				[{x: 1.27525945998532, y: -0.332075433844118, w:5.7066703873949, t: 0.313352188589399},{x: 1.27525945998532, y: -0.332075433844118, w:5.7066703873949, t: 0.313352188589399},{x: 0.655051891997064, y: 0.333584913231177, w:0, t: 0.513352188589399},{x: 0.655051891997064, y: 0.333584913231177, w:0, t: 0.513352188589399},],
				[{x: 1.37904306607379, y: 1.95315673792105, w:5.7857057416742, t: 0.00675367058627323},{x: 1.37904306607379, y: 1.95315673792105, w:5.7857057416742, t: 0.00675367058627323},{x: 0.675808613214757, y: 0.790631347584209, w:0, t: 0.206753670586273},{x: 0.675808613214757, y: 0.790631347584209, w:0, t: 0.206753670586273},],
				[{x: -0.799344473466448, y: -0.106927527573702, w:8.47708390066763, t: 0.150769531514364},{x: -0.799344473466448, y: -0.106927527573702, w:8.47708390066763, t: 0.150769531514364},{x: 0.24013110530671, y: 0.37861449448526, w:0, t: 0.350769531514364},{x: 0.24013110530671, y: 0.37861449448526, w:0, t: 0.350769531514364},],
				[{x: 1.74911377104949, y: 0.76518117612831, w:9.49028024299831, t: 0.552710399935424},{x: 1.74911377104949, y: 0.76518117612831, w:9.49028024299831, t: 0.552710399935424},{x: 0.749822754209899, y: 0.553036235225662, w:0, t: 0.752710399935424},{x: 0.749822754209899, y: 0.553036235225662, w:0, t: 0.752710399935424},],
				[{x: -0.00803064885691351, y: -0.390279425746555, w:9.38239822126545, t: 0.0176112943554348},{x: -0.00803064885691351, y: -0.390279425746555, w:9.38239822126545, t: 0.0176112943554348},{x: 0.398393870228617, y: 0.321944114850689, w:0, t: 0.217611294355435},{x: 0.398393870228617, y: 0.321944114850689, w:0, t: 0.217611294355435},],
				[{x: 1.00662812015143, y: 1.23617535781518, w:7.69002067584164, t: 0.029322850443722},{x: 1.00662812015143, y: 1.23617535781518, w:7.69002067584164, t: 0.029322850443722},{x: 0.601325624030287, y: 0.647235071563035, w:0, t: 0.229322850443722},{x: 0.601325624030287, y: 0.647235071563035, w:0, t: 0.229322850443722},],
				[{x: -0.872216093671195, y: 0.86721700258823, w:9.3966881183915, t: 0.632707024978272},{x: -0.872216093671195, y: 0.86721700258823, w:9.3966881183915, t: 0.632707024978272},{x: 0.225556781265761, y: 0.573443400517646, w:0, t: 0.832707024978272},{x: 0.225556781265761, y: 0.573443400517646, w:0, t: 0.832707024978272},],
				[{x: 1.45501661944964, y: 1.4618390367258, w:9.16066711520279, t: 0.126999466605691},{x: 1.45501661944964, y: 1.4618390367258, w:9.16066711520279, t: 0.126999466605691},{x: 0.691003323889928, y: 0.692367807345161, w:0, t: 0.326999466605691},{x: 0.691003323889928, y: 0.692367807345161, w:0, t: 0.326999466605691},],
				[{x: 1.46299127348267, y: -0.36328646858406, w:8.26327141340317, t: 0.562521543411112},{x: 1.46299127348267, y: -0.36328646858406, w:8.26327141340317, t: 0.562521543411112},{x: 0.692598254696533, y: 0.327342706283188, w:0, t: 0.762521543411112},{x: 0.692598254696533, y: 0.327342706283188, w:0, t: 0.762521543411112},],
				[{x: 0.645438875136923, y: 1.15734985406491, w:8.99515236483199, t: 0.00604239770188206},{x: 0.645438875136923, y: 1.15734985406491, w:8.99515236483199, t: 0.00604239770188206},{x: 0.529087775027385, y: 0.631469970812982, w:0, t: 0.206042397701882},{x: 0.529087775027385, y: 0.631469970812982, w:0, t: 0.206042397701882},],
				[{x: -0.401180349106315, y: 0.296534546849115, w:5.36734996089143, t: 0.593066115670721},{x: -0.401180349106315, y: 0.296534546849115, w:5.36734996089143, t: 0.593066115670721},{x: 0.319763930178737, y: 0.459306909369823, w:0, t: 0.793066115670721},{x: 0.319763930178737, y: 0.459306909369823, w:0, t: 0.793066115670721},],
				[{x: 1.50381804582454, y: 0.661601477068772, w:7.52683340572138, t: 0.471412762945326},{x: 1.50381804582454, y: 0.661601477068772, w:7.52683340572138, t: 0.471412762945326},{x: 0.700763609164909, y: 0.532320295413754, w:0, t: 0.671412762945326},{x: 0.700763609164909, y: 0.532320295413754, w:0, t: 0.671412762945326},],
				[{x: 0.272442597076221, y: -0.469467506704278, w:7.60819483544094, t: 0.164660415880351},{x: 0.272442597076221, y: -0.469467506704278, w:7.60819483544094, t: 0.164660415880351},{x: 0.454488519415244, y: 0.306106498659145, w:0, t: 0.364660415880351},{x: 0.454488519415244, y: 0.306106498659145, w:0, t: 0.364660415880351},],
				[{x: -0.338754337390921, y: 1.46998098214711, w:6.18814310945715, t: 0.307752967502899},{x: -0.338754337390921, y: 1.46998098214711, w:6.18814310945715, t: 0.307752967502899},{x: 0.332249132521816, y: 0.693996196429422, w:0, t: 0.507752967502899},{x: 0.332249132521816, y: 0.693996196429422, w:0, t: 0.507752967502899},],
				[{x: -0.275450911646921, y: -0.218679816948177, w:7.34816626237627, t: 0.310475281693231},{x: -0.275450911646921, y: -0.218679816948177, w:7.34816626237627, t: 0.310475281693231},{x: 0.344909817670616, y: 0.356264036610365, w:0, t: 0.510475281693231},{x: 0.344909817670616, y: 0.356264036610365, w:0, t: 0.510475281693231},],
				[{x: 1.91985653561576, y: 0.470114587500158, w:5.29913744083686, t: 0.653758582273769},{x: 1.91985653561576, y: 0.470114587500158, w:5.29913744083686, t: 0.653758582273769},{x: 0.783971307123151, y: 0.494022917500032, w:0, t: 0.853758582273769},{x: 0.783971307123151, y: 0.494022917500032, w:0, t: 0.853758582273769},],
				[{x: 1.21908175056772, y: -0.91629963451847, w:7.16886983304436, t: 0.141465452602366},{x: 1.21908175056772, y: -0.91629963451847, w:7.16886983304436, t: 0.141465452602366},{x: 0.643816350113545, y: 0.216740073096306, w:0, t: 0.341465452602366},{x: 0.643816350113545, y: 0.216740073096306, w:0, t: 0.341465452602366},],
				[{x: 1.17606517620379, y: 1.91109660205819, w:5.65400494089337, t: 0.527881330728086},{x: 1.17606517620379, y: 1.91109660205819, w:5.65400494089337, t: 0.527881330728086},{x: 0.635213035240757, y: 0.782219320411637, w:0, t: 0.727881330728086},{x: 0.635213035240757, y: 0.782219320411637, w:0, t: 0.727881330728086},],
				[{x: -0.765477684950827, y: 1.26400351784559, w:7.39427039708126, t: 0.0189605007874597},{x: -0.765477684950827, y: 1.26400351784559, w:7.39427039708126, t: 0.0189605007874597},{x: 0.246904463009835, y: 0.652800703569119, w:0, t: 0.21896050078746},{x: 0.246904463009835, y: 0.652800703569119, w:0, t: 0.21896050078746},],
				[{x: 1.1690774266949, y: -0.23016513956016, w:7.71015060816464, t: 0.0637268330385948},{x: 1.1690774266949, y: -0.23016513956016, w:7.71015060816464, t: 0.0637268330385948},{x: 0.63381548533898, y: 0.353966972087968, w:0, t: 0.263726833038595},{x: 0.63381548533898, y: 0.353966972087968, w:0, t: 0.263726833038595},],
				[{x: 0.870038316249333, y: -0.983250125090774, w:5.60725768409828, t: 0.0878738085698827},{x: 0.870038316249333, y: -0.983250125090774, w:5.60725768409828, t: 0.0878738085698827},{x: 0.574007663249867, y: 0.203349974981845, w:0, t: 0.287873808569883},{x: 0.574007663249867, y: 0.203349974981845, w:0, t: 0.287873808569883},],
				[{x: 1.02948173628838, y: 1.49693266034412, w:6.32335198300616, t: 0.389492390802481},{x: 1.02948173628838, y: 1.49693266034412, w:6.32335198300616, t: 0.389492390802481},{x: 0.605896347257675, y: 0.699386532068823, w:0, t: 0.589492390802481},{x: 0.605896347257675, y: 0.699386532068823, w:0, t: 0.589492390802481},],
				[{x: -0.279320631865568, y: 1.31661844030298, w:7.45778974567168, t: 0.443398075640189},{x: -0.279320631865568, y: 1.31661844030298, w:7.45778974567168, t: 0.443398075640189},{x: 0.344135873626886, y: 0.663323688060595, w:0, t: 0.643398075640189},{x: 0.344135873626886, y: 0.663323688060595, w:0, t: 0.643398075640189},],
				[{x: 1.62811434210634, y: 0.962768794064271, w:5.68063085913299, t: 0.660393811543961},{x: 1.62811434210634, y: 0.962768794064271, w:5.68063085913299, t: 0.660393811543961},{x: 0.725622868421268, y: 0.592553758812854, w:0, t: 0.860393811543961},{x: 0.725622868421268, y: 0.592553758812854, w:0, t: 0.860393811543961},],
				[{x: 0.672875654431645, y: -0.182740799478094, w:8.10777709491178, t: 0.312210982925005},{x: 0.672875654431645, y: -0.182740799478094, w:8.10777709491178, t: 0.312210982925005},{x: 0.534575130886329, y: 0.363451840104381, w:0, t: 0.512210982925005},{x: 0.534575130886329, y: 0.363451840104381, w:0, t: 0.512210982925005},],
				[{x: 0.70665950341813, y: 1.59692102963751, w:5.25641811154551, t: 0.0818821843542517},{x: 0.70665950341813, y: 1.59692102963751, w:5.25641811154551, t: 0.0818821843542517},{x: 0.541331900683626, y: 0.719384205927501, w:0, t: 0.281882184354252},{x: 0.541331900683626, y: 0.719384205927501, w:0, t: 0.281882184354252},],
				[{x: -0.84464202380158, y: 0.630516749808225, w:9.4781298192723, t: 0.742887498313565},{x: -0.84464202380158, y: 0.630516749808225, w:9.4781298192723, t: 0.742887498313565},{x: 0.231071595239684, y: 0.526103349961645, w:0, t: 0.942887498313566},{x: 0.231071595239684, y: 0.526103349961645, w:0, t: 0.942887498313566},],
				[{x: 1.04605429718552, y: -0.370051807516125, w:5.2438941436795, t: 0.263049647402394},{x: 1.04605429718552, y: -0.370051807516125, w:5.2438941436795, t: 0.263049647402394},{x: 0.609210859437104, y: 0.325989638496775, w:0, t: 0.463049647402394},{x: 0.609210859437104, y: 0.325989638496775, w:0, t: 0.463049647402394},],
				[{x: 0.203241346842273, y: -0.486760419691982, w:8.13611549226416, t: 0.368949716371465},{x: 0.203241346842273, y: -0.486760419691982, w:8.13611549226416, t: 0.368949716371465},{x: 0.440648269368455, y: 0.302647916061604, w:0, t: 0.568949716371465},{x: 0.440648269368455, y: 0.302647916061604, w:0, t: 0.568949716371465},],
				[{x: 0.184983893431681, y: 1.18938907571785, w:8.31970833934647, t: 0.269221579749137},{x: 0.184983893431681, y: 1.18938907571785, w:8.31970833934647, t: 0.269221579749137},{x: 0.436996778686336, y: 0.63787781514357, w:0, t: 0.469221579749137},{x: 0.436996778686336, y: 0.63787781514357, w:0, t: 0.469221579749137},],
				[{x: -0.273806837653858, y: 1.14572400485111, w:6.66609310714615, t: 0.531791866750392},{x: -0.273806837653858, y: 1.14572400485111, w:6.66609310714615, t: 0.531791866750392},{x: 0.345238632469228, y: 0.629144800970222, w:0, t: 0.731791866750392},{x: 0.345238632469228, y: 0.629144800970222, w:0, t: 0.731791866750392},],
				[{x: 1.63032354241897, y: 0.321121573971285, w:6.61221275981324, t: 0.457233419949436},{x: 1.63032354241897, y: 0.321121573971285, w:6.61221275981324, t: 0.457233419949436},{x: 0.726064708483795, y: 0.464224314794257, w:0, t: 0.657233419949436},{x: 0.726064708483795, y: 0.464224314794257, w:0, t: 0.657233419949436},],
				[{x: 0.902641475226333, y: -0.795764447166671, w:8.83952467741793, t: 0.776866601294948},{x: 0.902641475226333, y: -0.795764447166671, w:8.83952467741793, t: 0.776866601294948},{x: 0.580528295045267, y: 0.240847110566666, w:0, t: 0.976866601294948},{x: 0.580528295045267, y: 0.240847110566666, w:0, t: 0.976866601294948},],
				[{x: 0.511125081690898, y: 1.60116717842988, w:5.92312797000659, t: 0.228537523521243},{x: 0.511125081690898, y: 1.60116717842988, w:5.92312797000659, t: 0.228537523521243},{x: 0.50222501633818, y: 0.720233435685976, w:0, t: 0.428537523521243},{x: 0.50222501633818, y: 0.720233435685976, w:0, t: 0.428537523521243},],
				[{x: -0.00982049232459492, y: 0.762816941168488, w:6.7163022282686, t: 0.310136918997458},{x: -0.00982049232459492, y: 0.762816941168488, w:6.7163022282686, t: 0.310136918997458},{x: 0.398035901535081, y: 0.552563388233698, w:0, t: 0.510136918997458},{x: 0.398035901535081, y: 0.552563388233698, w:0, t: 0.510136918997458},],
				[{x: 1.06804454759748, y: 1.0933653680398, w:9.00915897475298, t: 0.0645451914538082},{x: 1.06804454759748, y: 1.0933653680398, w:9.00915897475298, t: 0.0645451914538082},{x: 0.613608909519497, y: 0.61867307360796, w:0, t: 0.264545191453808},{x: 0.613608909519497, y: 0.61867307360796, w:0, t: 0.264545191453808},],
				[{x: 1.43734689873029, y: -0.422055542168809, w:6.25258108494104, t: 0.623565842480624},{x: 1.43734689873029, y: -0.422055542168809, w:6.25258108494104, t: 0.623565842480624},{x: 0.687469379746058, y: 0.315588891566238, w:0, t: 0.823565842480624},{x: 0.687469379746058, y: 0.315588891566238, w:0, t: 0.823565842480624},],
				[{x: 0.23168659529609, y: 1.13582247364497, w:9.59679959453845, t: 0.0576083676298051},{x: 0.23168659529609, y: 1.13582247364497, w:9.59679959453845, t: 0.0576083676298051},{x: 0.446337319059218, y: 0.627164494728994, w:0, t: 0.257608367629805},{x: 0.446337319059218, y: 0.627164494728994, w:0, t: 0.257608367629805},],
				[{x: -0.742866391080143, y: 0.202193075173527, w:7.42684768690646, t: 0.00777646318426282},{x: -0.742866391080143, y: 0.202193075173527, w:7.42684768690646, t: 0.00777646318426282},{x: 0.251426721783971, y: 0.440438615034705, w:0, t: 0.207776463184263},{x: 0.251426721783971, y: 0.440438615034705, w:0, t: 0.207776463184263},],
				[{x: 1.08479751546556, y: -0.0753644214396942, w:6.43043559830234, t: 0.78581878794452},{x: 1.08479751546556, y: -0.0753644214396942, w:6.43043559830234, t: 0.78581878794452},{x: 0.616959503093112, y: 0.384927115712061, w:0, t: 0.98581878794452},{x: 0.616959503093112, y: 0.384927115712061, w:0, t: 0.98581878794452},],
				[{x: 0.413895321358848, y: -0.313336899876063, w:6.00126515139047, t: 0.447217579262652},{x: 0.413895321358848, y: -0.313336899876063, w:6.00126515139047, t: 0.447217579262652},{x: 0.48277906427177, y: 0.337332620024787, w:0, t: 0.647217579262652},{x: 0.48277906427177, y: 0.337332620024787, w:0, t: 0.647217579262652},],
				[{x: 0.548933468751475, y: 1.35902118998465, w:6.2018314067418, t: 0.353271775916241},{x: 0.548933468751475, y: 1.35902118998465, w:6.2018314067418, t: 0.353271775916241},{x: 0.509786693750295, y: 0.671804237996929, w:0, t: 0.553271775916241},{x: 0.509786693750295, y: 0.671804237996929, w:0, t: 0.553271775916241},],
				[{x: -0.53783884380526, y: 0.607434762598208, w:8.21933094462234, t: 0.0503480789689827},{x: -0.53783884380526, y: 0.607434762598208, w:8.21933094462234, t: 0.0503480789689827},{x: 0.292432231238948, y: 0.521486952519642, w:0, t: 0.250348078968983},{x: 0.292432231238948, y: 0.521486952519642, w:0, t: 0.250348078968983},],
				[{x: 1.94977179484354, y: 0.842670028406541, w:9.54927250864499, t: 0.010122332344613},{x: 1.94977179484354, y: 0.842670028406541, w:9.54927250864499, t: 0.010122332344613},{x: 0.789954358968708, y: 0.568534005681308, w:0, t: 0.210122332344613},{x: 0.789954358968708, y: 0.568534005681308, w:0, t: 0.210122332344613},],
				[{x: -0.01885570482996, y: -0.216693268110012, w:9.0289034174558, t: 0.370965086735412},{x: -0.01885570482996, y: -0.216693268110012, w:9.0289034174558, t: 0.370965086735412},{x: 0.396228859034008, y: 0.356661346377998, w:0, t: 0.570965086735411},{x: 0.396228859034008, y: 0.356661346377998, w:0, t: 0.570965086735411},],
				[{x: 0.0155125893643044, y: 1.25153751347165, w:6.13905329961692, t: 0.761543604596148},{x: 0.0155125893643044, y: 1.25153751347165, w:6.13905329961692, t: 0.761543604596148},{x: 0.403102517872861, y: 0.650307502694329, w:0, t: 0.961543604596148},{x: 0.403102517872861, y: 0.650307502694329, w:0, t: 0.961543604596148},],
				[{x: -0.0714160021853372, y: 0.11108003148756, w:7.66291391413111, t: 0.278058855670571},{x: -0.0714160021853372, y: 0.11108003148756, w:7.66291391413111, t: 0.278058855670571},{x: 0.385716799562933, y: 0.422216006297512, w:0, t: 0.478058855670571},{x: 0.385716799562933, y: 0.422216006297512, w:0, t: 0.478058855670571},],
				[{x: 1.39249401548473, y: 1.29295958990677, w:6.93768495454091, t: 0.100514461556757},{x: 1.39249401548473, y: 1.29295958990677, w:6.93768495454091, t: 0.100514461556757},{x: 0.678498803096946, y: 0.658591917981354, w:0, t: 0.300514461556757},{x: 0.678498803096946, y: 0.658591917981354, w:0, t: 0.300514461556757},],
				[{x: 0.801959061044332, y: -0.725065628873604, w:8.40915919248688, t: 0.17455687713958},{x: 0.801959061044332, y: -0.725065628873604, w:8.40915919248688, t: 0.17455687713958},{x: 0.560391812208866, y: 0.254986874225279, w:0, t: 0.37455687713958},{x: 0.560391812208866, y: 0.254986874225279, w:0, t: 0.37455687713958},],
				[{x: 0.0849111584854139, y: 1.16583847016073, w:8.49143926708988, t: 0.447673863897277},{x: 0.0849111584854139, y: 1.16583847016073, w:8.49143926708988, t: 0.447673863897277},{x: 0.416982231697083, y: 0.633167694032145, w:0, t: 0.647673863897277},{x: 0.416982231697083, y: 0.633167694032145, w:0, t: 0.647673863897277},],
				[{x: -0.890489371716874, y: 1.47493789799795, w:7.50075575551507, t: 0.236421515824084},{x: -0.890489371716874, y: 1.47493789799795, w:7.50075575551507, t: 0.236421515824084},{x: 0.221902125656625, y: 0.694987579599589, w:0, t: 0.436421515824084},{x: 0.221902125656625, y: 0.694987579599589, w:0, t: 0.436421515824084},],
				[{x: 1.22086550049713, y: -0.423403112604038, w:9.56682500054315, t: 0.0557322386245843},{x: 1.22086550049713, y: -0.423403112604038, w:9.56682500054315, t: 0.0557322386245843},{x: 0.644173100099425, y: 0.315319377479192, w:0, t: 0.255732238624584},{x: 0.644173100099425, y: 0.315319377479192, w:0, t: 0.255732238624584},],
				[{x: 0.826814911946908, y: -0.884921574058694, w:5.27305042387424, t: 0.266531498571919},{x: 0.826814911946908, y: -0.884921574058694, w:5.27305042387424, t: 0.266531498571919},{x: 0.565362982389382, y: 0.223015685188261, w:0, t: 0.46653149857192},{x: 0.565362982389382, y: 0.223015685188261, w:0, t: 0.46653149857192},],
				[{x: 1.49530634814384, y: 1.11943740304564, w:6.60153764494916, t: 0.240761247764649},{x: 1.49530634814384, y: 1.11943740304564, w:6.60153764494916, t: 0.240761247764649},{x: 0.699061269628767, y: 0.623887480609128, w:0, t: 0.440761247764649},{x: 0.699061269628767, y: 0.623887480609128, w:0, t: 0.440761247764649},],
				[{x: -0.763484184637739, y: -0.0992812068441271, w:5.83913836251766, t: 0.311585503803308},{x: -0.763484184637739, y: -0.0992812068441271, w:5.83913836251766, t: 0.311585503803308},{x: 0.247303163072452, y: 0.380143758631175, w:0, t: 0.511585503803308},{x: 0.247303163072452, y: 0.380143758631175, w:0, t: 0.511585503803308},],
				[{x: 1.83899071974763, y: 1.30942521304896, w:9.14290082669808, t: 0.732549950060199},{x: 1.83899071974763, y: 1.30942521304896, w:9.14290082669808, t: 0.732549950060199},{x: 0.767798143949526, y: 0.661885042609792, w:0, t: 0.932549950060199},{x: 0.767798143949526, y: 0.661885042609792, w:0, t: 0.932549950060199},],
				[{x: -0.395729825483346, y: -0.239639355947388, w:7.01286795870154, t: 0.147302892462298},{x: -0.395729825483346, y: -0.239639355947388, w:7.01286795870154, t: 0.147302892462298},{x: 0.320854034903331, y: 0.352072128810522, w:0, t: 0.347302892462298},{x: 0.320854034903331, y: 0.352072128810522, w:0, t: 0.347302892462298},],
				[{x: 1.11192389433644, y: 1.26648307964069, w:6.91783618918063, t: 0.699969597841025},{x: 1.11192389433644, y: 1.26648307964069, w:6.91783618918063, t: 0.699969597841025},{x: 0.622384778867288, y: 0.653296615928137, w:0, t: 0.899969597841025},{x: 0.622384778867288, y: 0.653296615928137, w:0, t: 0.899969597841025},],
				[{x: -0.427522080105186, y: 0.326666760896355, w:8.20623180170196, t: 0.604099456135796},{x: -0.427522080105186, y: 0.326666760896355, w:8.20623180170196, t: 0.604099456135796},{x: 0.314495583978963, y: 0.465333352179271, w:0, t: 0.804099456135796},{x: 0.314495583978963, y: 0.465333352179271, w:0, t: 0.804099456135796},],
				[{x: 1.77210448547096, y: 0.0521453133259278, w:8.92416645464352, t: 0.149521287423051},{x: 1.77210448547096, y: 0.0521453133259278, w:8.92416645464352, t: 0.149521287423051},{x: 0.754420897094191, y: 0.410429062665186, w:0, t: 0.349521287423051},{x: 0.754420897094191, y: 0.410429062665186, w:0, t: 0.349521287423051},],
				[{x: 0.989802849855475, y: -0.460536327961851, w:6.8664710474501, t: 0.53471389308325},{x: 0.989802849855475, y: -0.460536327961851, w:6.8664710474501, t: 0.53471389308325},{x: 0.597960569971095, y: 0.30789273440763, w:0, t: 0.73471389308325},{x: 0.597960569971095, y: 0.30789273440763, w:0, t: 0.73471389308325},],
				[{x: 0.742707728255573, y: 1.44807264271484, w:6.09184018989218, t: 0.283464760506106},{x: 0.742707728255573, y: 1.44807264271484, w:6.09184018989218, t: 0.283464760506106},{x: 0.548541545651115, y: 0.689614528542968, w:0, t: 0.483464760506106},{x: 0.548541545651115, y: 0.689614528542968, w:0, t: 0.483464760506106},],
				[{x: -0.1062238744392, y: 0.0939955822515206, w:8.22919595422085, t: 0.0500604794588405},{x: -0.1062238744392, y: 0.0939955822515206, w:8.22919595422085, t: 0.0500604794588405},{x: 0.37875522511216, y: 0.418799116450304, w:0, t: 0.250060479458841},{x: 0.37875522511216, y: 0.418799116450304, w:0, t: 0.250060479458841},],
				[{x: 1.37581978415928, y: -0.291118132940753, w:5.44659116996686, t: 0.657593446584363},{x: 1.37581978415928, y: -0.291118132940753, w:5.44659116996686, t: 0.657593446584363},{x: 0.675163956831856, y: 0.341776373411849, w:0, t: 0.857593446584363},{x: 0.675163956831856, y: 0.341776373411849, w:0, t: 0.857593446584363},],
				[{x: 1.02966214856882, y: -0.280990988040162, w:7.38802607231513, t: 0.715313677035335},{x: 1.02966214856882, y: -0.280990988040162, w:7.38802607231513, t: 0.715313677035335},{x: 0.605932429713764, y: 0.343801802391968, w:0, t: 0.915313677035335},{x: 0.605932429713764, y: 0.343801802391968, w:0, t: 0.915313677035335},],
				[{x: 0.237731030984465, y: 1.57467967584818, w:8.14886843843914, t: 0.604647721606242},{x: 0.237731030984465, y: 1.57467967584818, w:8.14886843843914, t: 0.604647721606242},{x: 0.447546206196893, y: 0.714935935169636, w:0, t: 0.804647721606242},{x: 0.447546206196893, y: 0.714935935169636, w:0, t: 0.804647721606242},],
				[{x: -0.272709024498887, y: 0.563835547819204, w:5.47186684443016, t: 0.0937107530112773},{x: -0.272709024498887, y: 0.563835547819204, w:5.47186684443016, t: 0.0937107530112773},{x: 0.345458195100223, y: 0.512767109563841, w:0, t: 0.293710753011277},{x: 0.345458195100223, y: 0.512767109563841, w:0, t: 0.293710753011277},],
				[{x: 1.268974352415, y: 1.13945920687763, w:8.64792929920153, t: 0.27035982234723},{x: 1.268974352415, y: 1.13945920687763, w:8.64792929920153, t: 0.27035982234723},{x: 0.653794870482999, y: 0.627891841375527, w:0, t: 0.47035982234723},{x: 0.653794870482999, y: 0.627891841375527, w:0, t: 0.47035982234723},],
				[{x: -0.472307239155342, y: -0.397779503836286, w:7.95654217126205, t: 0.163176591282731},{x: -0.472307239155342, y: -0.397779503836286, w:7.95654217126205, t: 0.163176591282731},{x: 0.305538552168932, y: 0.320444099232743, w:0, t: 0.363176591282731},{x: 0.305538552168932, y: 0.320444099232743, w:0, t: 0.363176591282731},],
				[{x: 0.624064861900499, y: 1.69647084970522, w:6.99096298282214, t: 0.570146878321166},{x: 0.624064861900499, y: 1.69647084970522, w:6.99096298282214, t: 0.570146878321166},{x: 0.5248129723801, y: 0.739294169941043, w:0, t: 0.770146878321166},{x: 0.5248129723801, y: 0.739294169941043, w:0, t: 0.770146878321166},],
				[{x: -0.089244861006325, y: -0.0684505183473489, w:8.89516292990175, t: 0.727108254634007},{x: -0.089244861006325, y: -0.0684505183473489, w:8.89516292990175, t: 0.727108254634007},{x: 0.382151027798735, y: 0.38630989633053, w:0, t: 0.927108254634007},{x: 0.382151027798735, y: 0.38630989633053, w:0, t: 0.927108254634007},],
				[{x: 1.84423084644133, y: 1.41227953834297, w:6.7189295679551, t: 0.239001188791103},{x: 1.84423084644133, y: 1.41227953834297, w:6.7189295679551, t: 0.239001188791103},{x: 0.768846169288265, y: 0.682455907668595, w:0, t: 0.439001188791103},{x: 0.768846169288265, y: 0.682455907668595, w:0, t: 0.439001188791103},],
				[{x: 0.567180004765815, y: -0.457529521209876, w:5.14111033455943, t: 0.685213495766841},{x: 0.567180004765815, y: -0.457529521209876, w:5.14111033455943, t: 0.685213495766841},{x: 0.513436000953163, y: 0.308494095758025, w:0, t: 0.88521349576684},{x: 0.513436000953163, y: 0.308494095758025, w:0, t: 0.88521349576684},],
				[{x: 0.422843010827465, y: 1.81231999367298, w:8.77206425505284, t: 0.792384565755983},{x: 0.422843010827465, y: 1.81231999367298, w:8.77206425505284, t: 0.792384565755983},{x: 0.484568602165493, y: 0.762463998734596, w:0, t: 0.992384565755983},{x: 0.484568602165493, y: 0.762463998734596, w:0, t: 0.992384565755983},],
				[{x: -0.492152813329145, y: 0.0752524916142092, w:5.04382287918955, t: 0.139290247511441},{x: -0.492152813329145, y: 0.0752524916142092, w:5.04382287918955, t: 0.139290247511441},{x: 0.301569437334171, y: 0.415050498322842, w:0, t: 0.339290247511441},{x: 0.301569437334171, y: 0.415050498322842, w:0, t: 0.339290247511441},],
				[{x: 1.2125466053641, y: 0.580055870780627, w:8.66144344430633, t: 0.553222241340835},{x: 1.2125466053641, y: 0.580055870780627, w:8.66144344430633, t: 0.553222241340835},{x: 0.642509321072819, y: 0.516011174156126, w:0, t: 0.753222241340835},{x: 0.642509321072819, y: 0.516011174156126, w:0, t: 0.753222241340835},],
				[{x: 1.43036983205152, y: -0.00531769174031538, w:8.97673290400408, t: 0.658838886304967},{x: 1.43036983205152, y: -0.00531769174031538, w:8.97673290400408, t: 0.658838886304967},{x: 0.686073966410304, y: 0.398936461651937, w:0, t: 0.858838886304967},{x: 0.686073966410304, y: 0.398936461651937, w:0, t: 0.858838886304967},],
				[{x: 0.920329837405311, y: 1.55720685638534, w:7.07539095060164, t: 0.34469438989908},{x: 0.920329837405311, y: 1.55720685638534, w:7.07539095060164, t: 0.34469438989908},{x: 0.584065967481062, y: 0.711441371277068, w:0, t: 0.544694389899079},{x: 0.584065967481062, y: 0.711441371277068, w:0, t: 0.544694389899079},],
				[{x: -0.221683175772168, y: 0.11054492043115, w:7.60666202718048, t: 0.681332817485847},{x: -0.221683175772168, y: 0.11054492043115, w:7.60666202718048, t: 0.681332817485847},{x: 0.355663364845566, y: 0.42210898408623, w:0, t: 0.881332817485847},{x: 0.355663364845566, y: 0.42210898408623, w:0, t: 0.881332817485847},],
				[{x: 1.3703365556816, y: 1.37445490587361, w:8.26238751940798, t: 0.021727873691114},{x: 1.3703365556816, y: 1.37445490587361, w:8.26238751940798, t: 0.021727873691114},{x: 0.67406731113632, y: 0.674890981174721, w:0, t: 0.221727873691114},{x: 0.67406731113632, y: 0.674890981174721, w:0, t: 0.221727873691114},],
				[{x: -0.00382139037285723, y: -0.554639188693904, w:8.9821012223188, t: 0.185284402723709},{x: -0.00382139037285723, y: -0.554639188693904, w:8.9821012223188, t: 0.185284402723709},{x: 0.399235721925429, y: 0.289072162261219, w:0, t: 0.385284402723709},{x: 0.399235721925429, y: 0.289072162261219, w:0, t: 0.385284402723709},],
				[{x: 1.02565193746787, y: 1.4620534380014, w:9.85773133982111, t: 0.793941664437133},{x: 1.02565193746787, y: 1.4620534380014, w:9.85773133982111, t: 0.793941664437133},{x: 0.605130387493575, y: 0.692410687600281, w:0, t: 0.993941664437133},{x: 0.605130387493575, y: 0.692410687600281, w:0, t: 0.993941664437133},],
				[{x: -0.46053656483443, y: 1.34389605940473, w:7.49396276204265, t: 0.793160636055822},{x: -0.46053656483443, y: 1.34389605940473, w:7.49396276204265, t: 0.793160636055822},{x: 0.307892687033114, y: 0.668779211880946, w:0, t: 0.993160636055822},{x: 0.307892687033114, y: 0.668779211880946, w:0, t: 0.993160636055822},],
				[{x: 1.65663932709621, y: 0.611897817359294, w:5.94342469900032, t: 0.201112861213867},{x: 1.65663932709621, y: 0.611897817359294, w:5.94342469900032, t: 0.201112861213867},{x: 0.731327865419242, y: 0.522379563471859, w:0, t: 0.401112861213867},{x: 0.731327865419242, y: 0.522379563471859, w:0, t: 0.401112861213867},],
				[{x: 0.494183175918969, y: -0.519192071987582, w:5.13894574092803, t: 0.265313217289837},{x: 0.494183175918969, y: -0.519192071987582, w:5.13894574092803, t: 0.265313217289837},{x: 0.498836635183794, y: 0.296161585602484, w:0, t: 0.465313217289837},{x: 0.498836635183794, y: 0.296161585602484, w:0, t: 0.465313217289837},],
				[{x: -0.183787175573143, y: 1.25332129477781, w:7.4140265473053, t: 0.634199132195761},{x: -0.183787175573143, y: 1.25332129477781, w:7.4140265473053, t: 0.634199132195761},{x: 0.363242564885371, y: 0.650664258955563, w:0, t: 0.834199132195761},{x: 0.363242564885371, y: 0.650664258955563, w:0, t: 0.834199132195761},],
				[{x: -0.256727846973891, y: 0.218179082044036, w:9.82470909226971, t: 0.116324840118007},{x: -0.256727846973891, y: 0.218179082044036, w:9.82470909226971, t: 0.116324840118007},{x: 0.348654430605222, y: 0.443635816408807, w:0, t: 0.316324840118007},{x: 0.348654430605222, y: 0.443635816408807, w:0, t: 0.316324840118007},],
				[{x: 1.78031393380052, y: 0.212398536925534, w:7.41841172673326, t: 0.69851763517011},{x: 1.78031393380052, y: 0.212398536925534, w:7.41841172673326, t: 0.69851763517011},{x: 0.756062786760105, y: 0.442479707385107, w:0, t: 0.89851763517011},{x: 0.756062786760105, y: 0.442479707385107, w:0, t: 0.89851763517011},],
				[{x: 0.181943363741046, y: -0.682633550996353, w:7.20862252790967, t: 0.203666693465198},{x: 0.181943363741046, y: -0.682633550996353, w:7.20862252790967, t: 0.203666693465198},{x: 0.436388672748209, y: 0.263473289800729, w:0, t: 0.403666693465198},{x: 0.436388672748209, y: 0.263473289800729, w:0, t: 0.403666693465198},],
				[{x: 0.850802104945595, y: 1.77613411585481, w:7.59546770341228, t: 0.162503061014749},{x: 0.850802104945595, y: 1.77613411585481, w:7.59546770341228, t: 0.162503061014749},{x: 0.570160420989119, y: 0.755226823170962, w:0, t: 0.362503061014749},{x: 0.570160420989119, y: 0.755226823170962, w:0, t: 0.362503061014749},],
				[{x: -0.373722068170274, y: 0.168663920054663, w:8.77485499241428, t: 0.051157031470354},{x: -0.373722068170274, y: 0.168663920054663, w:8.77485499241428, t: 0.051157031470354},{x: 0.325255586365945, y: 0.433732784010933, w:0, t: 0.251157031470354},{x: 0.325255586365945, y: 0.433732784010933, w:0, t: 0.251157031470354},],
				[{x: 1.53094026418099, y: 1.21188824245763, w:6.49966728924131, t: 0.0220418636606032},{x: 1.53094026418099, y: 1.21188824245763, w:6.49966728924131, t: 0.0220418636606032},{x: 0.706188052836199, y: 0.642377648491527, w:0, t: 0.222041863660603},{x: 0.706188052836199, y: 0.642377648491527, w:0, t: 0.222041863660603},],
				[{x: 0.863717523096228, y: -0.580806305917137, w:6.53293015233653, t: 0.444115392100783},{x: 0.863717523096228, y: -0.580806305917137, w:6.53293015233653, t: 0.444115392100783},{x: 0.572743504619246, y: 0.283838738816573, w:0, t: 0.644115392100783},{x: 0.572743504619246, y: 0.283838738816573, w:0, t: 0.644115392100783},],
				[{x: 1.24113220728727, y: 1.93328234318246, w:7.7761705274812, t: 0.297305451348829},{x: 1.24113220728727, y: 1.93328234318246, w:7.7761705274812, t: 0.297305451348829},{x: 0.648226441457453, y: 0.786656468636493, w:0, t: 0.497305451348829},{x: 0.648226441457453, y: 0.786656468636493, w:0, t: 0.497305451348829},],
				[{x: -0.00911588600185753, y: -0.351191183739555, w:6.55094936003879, t: 0.112407687728667},{x: -0.00911588600185753, y: -0.351191183739555, w:6.55094936003879, t: 0.112407687728667},{x: 0.398176822799629, y: 0.329761763252089, w:0, t: 0.312407687728668},{x: 0.398176822799629, y: 0.329761763252089, w:0, t: 0.312407687728668},],
				[{x: 1.35024395771725, y: 0.517358862655415, w:7.94778239228083, t: 0.40851770613546},{x: 1.35024395771725, y: 0.517358862655415, w:7.94778239228083, t: 0.40851770613546},{x: 0.67004879154345, y: 0.503471772531083, w:0, t: 0.60851770613546},{x: 0.67004879154345, y: 0.503471772531083, w:0, t: 0.60851770613546},],
				[{x: 0.992286192832502, y: -0.185802053922689, w:6.23118537192437, t: 0.265202839458712},{x: 0.992286192832502, y: -0.185802053922689, w:6.23118537192437, t: 0.265202839458712},{x: 0.5984572385665, y: 0.362839589215462, w:0, t: 0.465202839458712},{x: 0.5984572385665, y: 0.362839589215462, w:0, t: 0.465202839458712},],
				[{x: 0.264343424908648, y: 1.77778381235437, w:7.89888064078218, t: 0.0410905811075832},{x: 0.264343424908648, y: 1.77778381235437, w:7.89888064078218, t: 0.0410905811075832},{x: 0.452868684981729, y: 0.755556762470874, w:0, t: 0.241090581107583},{x: 0.452868684981729, y: 0.755556762470874, w:0, t: 0.241090581107583},],
				[{x: -0.128603707558633, y: 1.27458992287405, w:7.05848549826401, t: 0.582891155289498},{x: -0.128603707558633, y: 1.27458992287405, w:7.05848549826401, t: 0.582891155289498},{x: 0.374279258488273, y: 0.654917984574811, w:0, t: 0.782891155289498},{x: 0.374279258488273, y: 0.654917984574811, w:0, t: 0.782891155289498},],
				[{x: 1.65297612295447, y: 0.886519688704257, w:9.27992271255038, t: 0.169568172444596},{x: 1.65297612295447, y: 0.886519688704257, w:9.27992271255038, t: 0.169568172444596},{x: 0.730595224590893, y: 0.577303937740851, w:0, t: 0.369568172444596},{x: 0.730595224590893, y: 0.577303937740851, w:0, t: 0.369568172444596},],
				[{x: 0.0569406985045759, y: -0.168470153343236, w:5.80635529217239, t: 0.756267037229101},{x: 0.0569406985045759, y: -0.168470153343236, w:5.80635529217239, t: 0.756267037229101},{x: 0.411388139700915, y: 0.366305969331353, w:0, t: 0.956267037229101},{x: 0.411388139700915, y: 0.366305969331353, w:0, t: 0.956267037229101},],
				[{x: 1.26883054322474, y: 1.10494785269262, w:7.88574045220891, t: 0.658785900809814},{x: 1.26883054322474, y: 1.10494785269262, w:7.88574045220891, t: 0.658785900809814},{x: 0.653766108644948, y: 0.620989570538525, w:0, t: 0.858785900809814},{x: 0.653766108644948, y: 0.620989570538525, w:0, t: 0.858785900809814},],
				[{x: -0.950163152482742, y: 0.222504895329588, w:8.21324122077653, t: 0.306598145652403},{x: -0.950163152482742, y: 0.222504895329588, w:8.21324122077653, t: 0.306598145652403},{x: 0.209967369503452, y: 0.444500979065918, w:0, t: 0.506598145652403},{x: 0.209967369503452, y: 0.444500979065918, w:0, t: 0.506598145652403},],
				[{x: 1.87446810882788, y: 1.45085444685009, w:6.44009990308717, t: 0.167303773004292},{x: 1.87446810882788, y: 1.45085444685009, w:6.44009990308717, t: 0.167303773004292},{x: 0.774893621765575, y: 0.690170889370019, w:0, t: 0.367303773004292},{x: 0.774893621765575, y: 0.690170889370019, w:0, t: 0.367303773004292},],
				[{x: 0.630952348584676, y: -0.552165332077368, w:5.81437331404696, t: 0.425310775572215},{x: 0.630952348584676, y: -0.552165332077368, w:5.81437331404696, t: 0.425310775572215},{x: 0.526190469716935, y: 0.289566933584526, w:0, t: 0.625310775572215},{x: 0.526190469716935, y: 0.289566933584526, w:0, t: 0.625310775572215},],
				[{x: 0.883755418209012, y: 1.34010253733381, w:9.8866297938993, t: 0.392517735890124},{x: 0.883755418209012, y: 1.34010253733381, w:9.8866297938993, t: 0.392517735890124},{x: 0.576751083641802, y: 0.668020507466763, w:0, t: 0.592517735890124},{x: 0.576751083641802, y: 0.668020507466763, w:0, t: 0.592517735890124},],
				[{x: -0.57612477076734, y: 0.581536977082415, w:7.05409278289365, t: 0.576769190847715},{x: -0.57612477076734, y: 0.581536977082415, w:7.05409278289365, t: 0.576769190847715},{x: 0.284775045846532, y: 0.516307395416483, w:0, t: 0.776769190847715},{x: 0.284775045846532, y: 0.516307395416483, w:0, t: 0.776769190847715},],
				[{x: 1.54413488738962, y: -0.43949307900451, w:6.43879506768992, t: 0.744942703500647},{x: 1.54413488738962, y: -0.43949307900451, w:6.43879506768992, t: 0.744942703500647},{x: 0.708826977477923, y: 0.312101384199098, w:0, t: 0.944942703500647},{x: 0.708826977477923, y: 0.312101384199098, w:0, t: 0.944942703500647},],
				[{x: 1.06354875105125, y: -0.482104851361759, w:6.75618296767589, t: 0.608805437441148},{x: 1.06354875105125, y: -0.482104851361759, w:6.75618296767589, t: 0.608805437441148},{x: 0.61270975021025, y: 0.303579029727648, w:0, t: 0.808805437441148},{x: 0.61270975021025, y: 0.303579029727648, w:0, t: 0.808805437441148},],
				[{x: -0.190369622072393, y: 1.02238011328053, w:9.82573703899118, t: 0.380516347413439},{x: -0.190369622072393, y: 1.02238011328053, w:9.82573703899118, t: 0.380516347413439},{x: 0.361926075585521, y: 0.604476022656105, w:0, t: 0.580516347413439},{x: 0.361926075585521, y: 0.604476022656105, w:0, t: 0.580516347413439},],
				[{x: -0.0436974391195851, y: 0.580346959004894, w:5.67524705643354, t: 0.389881742969586},{x: -0.0436974391195851, y: 0.580346959004894, w:5.67524705643354, t: 0.389881742969586},{x: 0.391260512176083, y: 0.516069391800979, w:0, t: 0.589881742969586},{x: 0.391260512176083, y: 0.516069391800979, w:0, t: 0.589881742969586},],
				[{x: 1.20345431917735, y: -0.237316087447548, w:7.00387943545104, t: 0.210778326384551},{x: 1.20345431917735, y: -0.237316087447548, w:7.00387943545104, t: 0.210778326384551},{x: 0.64069086383547, y: 0.35253678251049, w:0, t: 0.410778326384551},{x: 0.64069086383547, y: 0.35253678251049, w:0, t: 0.410778326384551},],
				[{x: 0.862521821986818, y: -0.825286091164733, w:7.56314189449946, t: 0.163696568863667},{x: 0.862521821986818, y: -0.825286091164733, w:7.56314189449946, t: 0.163696568863667},{x: 0.572504364397364, y: 0.234942781767054, w:0, t: 0.363696568863667},{x: 0.572504364397364, y: 0.234942781767054, w:0, t: 0.363696568863667},],
				[{x: 0.515007394727174, y: 1.03936435358047, w:5.29517064825277, t: 0.339733318828832},{x: 0.515007394727174, y: 1.03936435358047, w:5.29517064825277, t: 0.339733318828832},{x: 0.503001478945435, y: 0.607872870716094, w:0, t: 0.539733318828832},{x: 0.503001478945435, y: 0.607872870716094, w:0, t: 0.539733318828832},],
				[{x: -0.133043441818608, y: 0.640161034773496, w:5.21065184667709, t: 0.112038425527294},{x: -0.133043441818608, y: 0.640161034773496, w:5.21065184667709, t: 0.112038425527294},{x: 0.373391311636278, y: 0.528032206954699, w:0, t: 0.312038425527294},{x: 0.373391311636278, y: 0.528032206954699, w:0, t: 0.312038425527294},],
				[{x: 1.71029596572785, y: 0.547960978380778, w:6.77922542117205, t: 0.0637029417714703},{x: 1.71029596572785, y: 0.547960978380778, w:6.77922542117205, t: 0.0637029417714703},{x: 0.742059193145571, y: 0.509592195676156, w:0, t: 0.26370294177147},{x: 0.742059193145571, y: 0.509592195676156, w:0, t: 0.26370294177147},],
				[{x: 0.736884577963983, y: -0.504580652904019, w:9.45909030692761, t: 0.183781392318295},{x: 0.736884577963983, y: -0.504580652904019, w:9.45909030692761, t: 0.183781392318295},{x: 0.547376915592797, y: 0.299083869419196, w:0, t: 0.383781392318295},{x: 0.547376915592797, y: 0.299083869419196, w:0, t: 0.383781392318295},],
				[{x: 1.13739871433175, y: 1.81165748330642, w:6.63522660318273, t: 0.253963444030016},{x: 1.13739871433175, y: 1.81165748330642, w:6.63522660318273, t: 0.253963444030016},{x: 0.627479742866349, y: 0.762331496661283, w:0, t: 0.453963444030016},{x: 0.627479742866349, y: 0.762331496661283, w:0, t: 0.453963444030016},],
				[{x: -0.968898424067269, y: 0.688014964557554, w:5.35844239536966, t: 0.228804152041175},{x: -0.968898424067269, y: 0.688014964557554, w:5.35844239536966, t: 0.228804152041175},{x: 0.206220315186546, y: 0.537602992911511, w:0, t: 0.428804152041175},{x: 0.206220315186546, y: 0.537602992911511, w:0, t: 0.428804152041175},],
				[{x: 1.90281099941067, y: 1.296920881661, w:8.08746895872907, t: 0.284291374799953},{x: 1.90281099941067, y: 1.296920881661, w:8.08746895872907, t: 0.284291374799953},{x: 0.780562199882134, y: 0.6593841763322, w:0, t: 0.484291374799953},{x: 0.780562199882134, y: 0.6593841763322, w:0, t: 0.484291374799953},],
				[{x: 1.0268551539182, y: -0.106455985208276, w:7.29330645241433, t: 0.57252125259474},{x: 1.0268551539182, y: -0.106455985208276, w:7.29330645241433, t: 0.57252125259474},{x: 0.60537103078364, y: 0.378708802958345, w:0, t: 0.77252125259474},{x: 0.60537103078364, y: 0.378708802958345, w:0, t: 0.77252125259474},],
				[{x: -0.467144998814185, y: 1.71675472402556, w:7.33248461352714, t: 0.534729293890807},{x: -0.467144998814185, y: 1.71675472402556, w:7.33248461352714, t: 0.534729293890807},{x: 0.306571000237163, y: 0.743350944805111, w:0, t: 0.734729293890807},{x: 0.306571000237163, y: 0.743350944805111, w:0, t: 0.734729293890807},],

			], bgWarpObjNum: 1, bgWarpObjSpeed: 0.1,
			templateType: "songTitle", charColorHSB: [92,228,189],
		},
		{ indexType: "beat", startIndex: 96, endIndex: 104,
			backgroundType: "wave", bgColorHSB: [140,240,41], bgWaveCount: 120, bgWaveColorHSB: [140,240,58],
			templateType: "songArtist", charColorHSB: [92,228,189] },
		{ indexType: "beat", startIndex: 104, endIndex: 108,
			backgroundType: "wave", bgColorHSB: [140,240,41], bgWaveCount: 120, bgWaveColorHSB: [140,240,58],
			templateType: "default" },
		{ indexType: "beat", startIndex: 108, endIndex: 99999,
			backgroundType: "default", bgColorHSB: [84,37,54], bgBeatAmpS: 20,
			templateType: "default"  },



		/*{ indexType: "beat", startIndex: 20, endIndex: 99999,
			backgroundType: "warp", bgColorHSB: [140,240,41], bgWarpObjType: "point", bgWarpObjColorHSB: [140,240,240],
			bgWarpObjCurve: [
				[{x: 0, y: 0.3, w:1.0}, {x: 0, y: 0.3, w:1.0, t:0.0},{x: 0.5, y: 0.1, w:2.0, t:0.5},{x: 1, y: -0.1, w:3.0, t:1.0},{x: 1, y: -0.1, w:3.0},],
				[{x: 0, y: 0.4, w:1.0}, {x: 0, y: 0.4, w:1.0, t:0.0},{x: 0.5, y: 0.3, w:2.0, t:0.5},{x: 1, y: 0.2, w:3.0, t:1.0},{x: 1, y: 0.2, w:3.0},],
				[{x: 0, y: 0.5, w:1.0}, {x: 0, y: 0.5, w:1.0, t:0.0},{x: 0.5, y: 0.5, w:2.0, t:0.5},{x: 1, y: 0.5, w:3.0, t:1.0},{x: 1, y: 0.5, w:3.0},],
				[{x: 0, y: 0.6, w:1.0}, {x: 0, y: 0.6, w:1.0, t:0.0},{x: 0.5, y: 0.7, w:2.0, t:0.5},{x: 1, y: 0.8, w:3.0, t:1.0},{x: 1, y: 0.8, w:3.0},],
				[{x: 0, y: 0.7, w:1.0}, {x: 0, y: 0.7, w:1.0, t:0.0},{x: 0.5, y: 0.9, w:2.0, t:0.5},{x: 1, y: 1.1, w:3.0, t:1.0},{x: 1, y: 1.1, w:3.0},],
			], bgWarpObjNum: 20, bgWarpObjSpeed: 1.0,
			templateType: "default",
		}*/

	],

	
	// DEBUG MODE
	devMode: false
};

let init = false;
let devMessage = "";
let templateIndex = 0;
let dataStore = {
	background: {
	},
	char: {
	},
	chardeco: {
	},

};
let tool = {
	progressToSinWave: (progress) => {
		return 0.5 * (1 + Math.cos(2 * Math.PI * progress));
	},

};

// リスナの登録 / Register listeners
player.addListener({
	onAppReady: (app) => {
		if (!app.managed) {
			switch (myenv.selectSong) {
				case "Greenlights Serenade":
					// グリーンライツ・セレナーデ / Omoi feat. 初音ミク
					// - 初音ミク「マジカルミライ 2018」テーマソング
					// - 楽曲: http://www.youtube.com/watch?v=XSLhsjepelI
					// - 歌詞: https://piapro.jp/t/61Y2
					player.createFromSongUrl("http://www.youtube.com/watch?v=XSLhsjepelI", {
						video: {
							// 音楽地図訂正履歴: https://songle.jp/songs/1249410/history
							beatId: 3818919,
							chordId: 1207328,
							repetitiveSegmentId: 1942131,
							// 歌詞タイミング訂正履歴: https://textalive.jp/lyrics/www.youtube.com%2Fwatch%3Fv%3DXSLhsjepelI
							lyricId: 50145,
							lyricDiffId: 3168
						}
					});
					break;
				case "Bless Your Breath":
					// ブレス・ユア・ブレス / 和田たけあき feat. 初音ミク
					// - 初音ミク「マジカルミライ 2019」テーマソング
					// - 楽曲: http://www.youtube.com/watch?v=a-Nf3QUFkOU
					// - 歌詞: https://piapro.jp/t/Ytwu
					player.createFromSongUrl("http://www.youtube.com/watch?v=a-Nf3QUFkOU", {
						video: {
							// 音楽地図訂正履歴: https://songle.jp/songs/1688650/history
							beatId: 3818481,
							chordId: 1546157,
							repetitiveSegmentId: 1942135,
							// 歌詞タイミング訂正履歴: https://textalive.jp/lyrics/www.youtube.com%2Fwatch%3Fv=a-Nf3QUFkOU
							lyricId: 50146,
							lyricDiffId: 3143
						}
					});
					break;
				case "Ai Sarenakutemo Kimi Ga Iru":
					// 愛されなくても君がいる / ピノキオピー feat. 初音ミク
					// - 初音ミク「マジカルミライ 2020」テーマソング
					// - 楽曲: http://www.youtube.com/watch?v=ygY2qObZv24
					// - 歌詞: https://piapro.jp/t/PLR7
					player.createFromSongUrl("http://www.youtube.com/watch?v=ygY2qObZv24", {
						video: {
							// 音楽地図訂正履歴: https://songle.jp/songs/1977449/history
							beatId: 3818852,
							chordId: 1955797,
							repetitiveSegmentId: 1942043,
							// 歌詞タイミング訂正履歴: https://textalive.jp/lyrics/www.youtube.com%2Fwatch%3Fv=ygY2qObZv24
							lyricId: 50150,
							lyricDiffId: 3158
						}
					});
					break;
			}
		}
	},

	onTextLoad: (body) => {
		// Webフォントを確実に読み込むためDOM要素に歌詞を貼り付ける
		document.querySelector("#dummy").textContent = body?.text;
	},

	onVideoReady: () => {
		if (!player.app.managed) {
			document.querySelector("#message").className = "active";
		}
		document.querySelector("#overlay").className = "inactive";
	},

	onPlay: () => {
		document.querySelector("#message").className = "inactive";
		if (!player.app.managed) {
			document.querySelector("#control").className = "";
		}
		console.log("player.onPlay");
	},

	onPause: () => {
		console.log("player.onPause");
	},

	onSeek: () => {
		console.log("player.onSeek");
	},

	onStop: () => {
		if (!player.app.managed) {
			document.querySelector("#control").className = "active";
		}
		console.log("player.onStop");
	},
});

// 再生終了後に表示する巻き戻しボタン
document.querySelector("#rewind").addEventListener("click", () => {
	player.requestPlay();
});

// p5.js を初期化
new P5((p5) => {
	// キャンバスの大きさなどを計算
	const width = Math.min(640, window.innerWidth);
	const height = Math.min(270, window.innerHeight);
	const margin = 30;
	const numChars = 10;
	const textAreaWidth = width - margin * 2;
	var img_logo;
	//var img_bolt;
	//const fa = p5.loadFont("Font Awesome 5 Free");
	//const noto = p5.loadFont("Noto Sans JP");

	// キャンバスを作成
	p5.setup = () => {
		p5.createCanvas(width, height);
		p5.colorMode(p5.HSB, 100);
		p5.frameRate(30);
		p5.background(40);
		p5.noStroke();
		p5.textFont("Noto Sans JP");
		p5.textAlign(p5.CENTER, p5.CENTER);
		img_logo = p5.loadImage(images['mm2020_logo']);
	};

	// BACKGROUND
	p5.drawBackgroundWarp=()=>{
		// Load Parameters
		const params = myenv.templateMap[templateIndex];
		const position = player.timer.position;
		
		const backgroundColorHSB = params.bgColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 20;
		if (backgroundColorHSB) {
			colorH = backgroundColorHSB[0]*100/255;
			colorS = backgroundColorHSB[1]*100/255;
			colorB = backgroundColorHSB[2]*100/240;
		}
		p5.background(colorH, colorS, colorB);

		const bgColorHSB = params.bgWarpObjColorHSB;
		colorH = 0;
		colorS = 0;
		colorB = 40;
		if (bgColorHSB) {
			colorH = bgColorHSB[0]*100/255;
			colorS = bgColorHSB[1]*100/255;
			colorB = bgColorHSB[2]*100/240;
		}

		p5.stroke(colorH, colorS, colorB);
		p5.fill(colorH, colorS, colorB);
		// 速度bgWarpObjSpeedからt=0.0-1.0の変化に要する時間[msec]を算出
		const modPosition = 1000 / params.bgWarpObjSpeed;
		const t = 100 * (position % modPosition) / modPosition;
		console.log("modPosition = "+modPosition+"; params.bgWarpObjSpeed = "+params.bgWarpObjSpeed+";");
		let i=0;
		const tDiff = 100 / params.bgWarpObjNum;
		for (i=0; i<params.bgWarpObjCurve.length; i++){
			let j=0;
			for(j=0; j<params.bgWarpObjCurve[i].length-3; j++){
				const x1=params.bgWarpObjCurve[i][j+0].x * width;
                                const x2=params.bgWarpObjCurve[i][j+1].x * width;
				const x3=params.bgWarpObjCurve[i][j+2].x * width;
				const x4=params.bgWarpObjCurve[i][j+3].x * width;
				const y1=params.bgWarpObjCurve[i][j+0].y * height;
				const y2=params.bgWarpObjCurve[i][j+1].y * height;
				const y3=params.bgWarpObjCurve[i][j+2].y * height;
				const y4=params.bgWarpObjCurve[i][j+3].y * height;
				const w1=params.bgWarpObjCurve[i][j+0].w;
				const w2=params.bgWarpObjCurve[i][j+1].w;
				const w3=params.bgWarpObjCurve[i][j+2].w;
				const w4=params.bgWarpObjCurve[i][j+3].w;
				const t0=params.bgWarpObjCurve[i][j+1].t;
				const t1=params.bgWarpObjCurve[i][j+2].t;
				let k=0;
				for(k=0; k<params.bgWarpObjNum; k++){
					const tt = ((t + tDiff * k) % 100) / 100;
					if ((t0 <= tt) && (tt < t1)){
						const ttt = (tt-t0) / (t1-t0);
						const x=p5.curvePoint(x1,x2,x3,x4,ttt);
						const y=p5.curvePoint(y1,y2,y3,y4,ttt);
						const w=p5.curvePoint(w1,w2,w3,w4,ttt);
						switch (params.bgWarpObjType){
							case "point":
								p5.strokeWeight(w);
								p5.point(x, y);
								break;
						}
					}
				}
			}
		}
	};
	p5.drawBackgroundWave=()=>{
		const position = player.timer.position;
		let count = myenv.templateMap[templateIndex].bgWaveCount;
		if (!(count)){
			count = 120;
		}
		// 初期化
		if (!("wave" in dataStore.background)){
			dataStore.background.wave = {
				lastPosition: position,
				maxVolume: 10000,
				historyVolume: Array(count),
				historyCount: count,
				sign: 1,
			};
		}
		// countが変化している場合
		if (dataStore.background.wave.historyCount != count){
			delete dataStore.background.wave.historyVolume;
			dataStore.background.wave.historyVolume = Array(count);
			dataStore.background.wave.historyCount = count;
		}

		// いったん途切れてる場合初期化
		if (dataStore.background.wave.lastPosition + 1000 < position){
			delete dataStore.background.wave.historyVolume;
			dataStore.background.wave.historyVolume = Array(count);
			dataStore.background.wave.historyCount = count;
		}
		// Volume追加
		const sampleRate = 120; // Hz
		const sampleTime = 1000 / sampleRate; // msec.
		let tempPosition = dataStore.background.wave.lastPosition;
		while(tempPosition + sampleTime < position){
			tempPosition += sampleTime;
			const vol = player.getVocalAmplitude(position);
			dataStore.background.wave.historyVolume.push(vol);
			dataStore.background.wave.historyVolume.shift();
			if (vol>dataStore.background.wave.maxVolume){
				dataStore.background.wave.maxVolume = vol;
			}
		}
		// position更新
		dataStore.background.wave.lastPosition = position;
		// sign更新
		const sign = dataStore.background.wave.sign;
		dataStore.background.wave.sign = sign * (-1);

		devMessage += "wave.maxVolume = " + dataStore.background.wave.maxVolume + "<br>";
		devMessage += "wave.historyCount = " + dataStore.background.wave.historyCount + "<br>";

		const backgroundColorHSB = myenv.templateMap[templateIndex].bgColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 20;
		if (backgroundColorHSB) {
			colorH = backgroundColorHSB[0]*100/255;
			colorS = backgroundColorHSB[1]*100/255;
			colorB = backgroundColorHSB[2]*100/240;
		}
		p5.background(colorH, colorS, colorB);

		// bgWaveColorHSB
		const bgWaveColorHSB = myenv.templateMap[templateIndex].bgWaveColorHSB
		colorH = 0;
		colorS = 0;
		colorB = 40;
		if (bgWaveColorHSB) {
			colorH = bgWaveColorHSB[0]*100/255;
			colorS = bgWaveColorHSB[1]*100/255;
			colorB = bgWaveColorHSB[2]*100/240;
		}

		p5.stroke(colorH, colorS, colorB);
		p5.strokeWeight(1);
		p5.noFill();
		let i = 0;
		let wave = dataStore.background.wave;
		p5.beginShape();
		for (i=0; i<count; i++){
			p5.curveVertex(
				i * width / count,
				sign * (2*(i%2)-1) * wave.historyVolume[i] / wave.maxVolume * height / 2 + height / 2
			);
		}
		p5.endShape();
	}

	p5.drawBackground=()=>{
		const position = player.timer.position;
		const backgroundColorHSB = myenv.templateMap[templateIndex].bgColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 20;
		const bgBeatAmpS = myenv.templateMap[templateIndex].bgBeatAmpS;
		if (backgroundColorHSB) {
			colorH = backgroundColorHSB[0]*100/255;
			colorS = backgroundColorHSB[1]*100/255;
			colorB = backgroundColorHSB[2]*100/240;
		}
		if (bgBeatAmpS) {
			const xbeat = player.findBeat(position);
			if (xbeat) {
				const progress = xbeat.progress(position);
				colorS = colorS + bgBeatAmpS * tool.progressToSinWave(progress);
				if(colorS > 100){
					colorS = 100;
				}
				if(colorS < 0){
					colorS = 0;
				}
			}
		}
		p5.background(colorH, colorS, colorB);
		const beat = player.findBeat(position);
		if (beat) {
			devMessage += "beat.index     = " + beat.index + "<br>";
			devMessage += "beat.length    = " + beat.length + "<br>";
			devMessage += "beat.position  = " + beat.position + "<br>";
			devMessage += "beat.startTime = " + beat.startTime + "<br>";
			devMessage += "beat.endTime   = " + beat.endTime + "<br>";
			devMessage += "beat.duration  = " + beat.duration + "<br>";
			devMessage += "beat.progress  = " + beat.progress(position) + "<br><br>";
		}
		const chord = player.findChord(position);
		if (chord) {
			devMessage += "chord.index     = " + chord.index + "<br>";
			devMessage += "chord.name      = " + chord.name + "<br>";
			devMessage += "chord.startTime = " + chord.startTime + "<br>";
			devMessage += "chord.endTime   = " + chord.endTime + "<br>";
			devMessage += "chord.duration  = " + chord.duration + "<br>";
			devMessage += "chord.progress  = " + chord.progress(position) + "<br><br>";

		}
		const repetitiveSegment = player.findChorus(position);
		if (repetitiveSegment) {
			devMessage += "chorus.index     = " + repetitiveSegment.index + "<br>";
			devMessage += "chorus.startTime = " + repetitiveSegment.startTime + "<br>";
			devMessage += "chorus.endTime   = " + repetitiveSegment.endTime + "<br>";
			devMessage += "chorus.duration  = " + repetitiveSegment.duration + "<br>";
			devMessage += "chorus.progress  = " + repetitiveSegment.progress(position) + "<br><br>";
		}

		const amplitude = player.getVocalAmplitude(position);
		devMessage += "player.getVocalAmplitude = " + amplitude + "<br>";
		const va = player.getValenceArousal(position);
		if (va){
			devMessage += "player.getValenceArousal.Valence = " + va.v + "<br>";
			devMessage += "player.getValenceArousal.Arousal = " + va.a + "<br><br>";
		}

	};

	// CHARACTOR DECORATION
	p5.drawCharDeco=()=>{
		const position = player.timer.position;
		let phrase = player.video.findPhrase(position - 100, { loose: true });
		let char = phrase.firstChar;
		let count = phrase.charCount;
		let i = 0;
		while (i<count) {
			if (char.endTime + 320 < position) {

			}
			else if (char.startTime < position + 100) {
				const x = ((i%count) + 0.5) * (textAreaWidth / count);
				let weight, y = 0, size = 50;
				if (position < char.startTime) {
					const progress = 1 - (char.startTime - position) / 100;
					const eased = Ease.circIn(progress);
					weight = 5 * eased * 0;
					size = size * eased + Math.min(width, height) * (1 - eased) * 0;
				}
				else if(char.endTime < position) {
					const progress = (position - char.endTime) / 320;
					const eased = Ease.quadOut(progress);
					weight = 5 * (1 - eased);
					y = -eased * (height / 2);
					size = size + 390 * eased;
				}
				else{
					weight = 0;
				}
				p5.noFill();
				p5.stroke(255);
				p5.strokeWeight(weight);
				p5.ellipse(margin + x, height / 2 + y, size, size);
			}
			char = char.next;
			i++;
		}


	};

	// CHAR
	p5.drawChar=()=>{
		const position = player.timer.position;

		const charColorHSB = myenv.templateMap[templateIndex].charColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 100;
		if (charColorHSB) {
			colorH = charColorHSB[0]*100/255;
			colorS = charColorHSB[1]*100/255;
			colorB = charColorHSB[2]*100/240;
		}


		let phrase = player.video.findPhrase(position - 100, { loose: true });
		
		devMessage += "phrase.text      = " + phrase.text + "<br>";
		devMessage += "phrase.charCount = " + phrase.charCount + "<br>";
		devMessage += "phrase.wordCount = " + phrase.wordCount + "<br>";
		devMessage += "phrase.startTime = " + phrase.startTime + "<br>";
		devMessage += "phrase.endTime   = " + phrase.endTime + "<br>";
		devMessage += "phrase.duration  = " + phrase.duration + "<br>";
		devMessage += "phrase.progress  = " + (100*phrase.progress(position)).toFixed(2)+"%" + "<br><br>";

		const wCount = phrase.wordCount;
		let word = phrase.firstWord;
		i = 0;
		while(i<wCount){
			if (word.contains(position)) {
				devMessage += "word.index          = " + phrase.findIndex(word) + "<br>";
				devMessage += "word.text           = " + word.text + "<br>";
				devMessage += "word.language       = " + word.language + "<br>";
				devMessage += "word.Part-of-speech = " + word.pos + "<br>";
				devMessage += "word.startTime      = " + word.startTime + "<br>";
				devMessage += "word.endTime        = " + word.endTime + "<br>";
				devMessage += "word.duration       = " + word.duration + "<br>";
				devMessage += "word.progress       = " + (100*word.progress(position)).toFixed(2)+"%" + "<br><br>";
			}
			word = word.next;
			i++;
		}


		let char = phrase.firstChar;
		const count = phrase.charCount;
		let i = 0;
		while(i<count){
			if (char.contains(position)) {
				devMessage += "char.index     = " + phrase.findIndex(char) + "<br>";
				devMessage += "char.text      = " + char.text + "<br>";
				devMessage += "char.startTime = " + char.startTime + "<br>";
				devMessage += "char.endTime   = " + char.endTime + "<br>";
				devMessage += "char.duration  = " + char.duration + "<br>";
				devMessage += "char.progress  = " + (100*char.progress(position)).toFixed(2)+"%" + "<br><br>";
			}

			if (char.startTime < position + 100) {
				const x = ((i%count) + 0.5) * (textAreaWidth / count);
				let transparency,y = 0,size = 39;
				// 100 [ms] かけてフェードインしてくる
				if (position < char.startTime) {
					const progress = 1 - (char.startTime - position) / 100;
					const eased = Ease.circIn(progress);
					transparency = progress;
					size = 39 * eased + Math.min(width, height) * (1 - eased);
				}
				// 160 [ms] かけてフェードアウトする
				else if (phrase.endTime < position) {
					const progress = (position - char.endTime) / 160;
					const eased = Ease.quintIn(progress);
					transparency = 1 - eased;
					y = -eased * (height / 2);
				}
				// フレーズ区間中は完全に不透明
				else {
					transparency = 1;
				}
				p5.fill(colorH, colorS, colorB, transparency * 100);
				p5.noStroke();
				p5.textSize(size);
				p5.text(char.text, margin + x, height / 2 + y);
			}
			char = char.next;
			i++;
		}
	};
	
	p5.drawTitle=()=>{
		let title = player.data.song.name;
		let i = 0, size = 39, y = 0;
		let count = title.length;
		const charColorHSB = myenv.templateMap[templateIndex].charColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 100;
		if (charColorHSB) {
			colorH = charColorHSB[0]*100/255;
			colorS = charColorHSB[1]*100/255;
			colorB = charColorHSB[2]*100/240;
		}
		while(i<count){
			p5.fill(colorH, colorS, colorB, 100);
			p5.noStroke();
			p5.textSize(size);
			const x = ((i%count) + 0.5) * (textAreaWidth / count);
			p5.text(title.substr(i,1), margin + x, height / 2 + y);
			i++;
		}
	};

	p5.drawArtist=()=>{
		let title = player.data.song.artist.name;
		let i = 0, size = 39, y = 0;
		let count = title.length;
		const charColorHSB = myenv.templateMap[templateIndex].charColorHSB;
		let colorH = 0;
		let colorS = 0;
		let colorB = 100;
		if (charColorHSB) {
			colorH = charColorHSB[0]*100/255;
			colorS = charColorHSB[1]*100/255;
			colorB = charColorHSB[2]*100/240;
		}
		while(i<count){
			p5.fill(colorH, colorS, colorB, 100);
			p5.noStroke();
			p5.textSize(size);
			const x = ((i%count) + 0.5) * (textAreaWidth / count / 2) + textAreaWidth / 4;
			p5.text(title.substr(i,1), margin + x, height / 2 + y);
			i++;
		}
	};

	p5.processTemplate=()=>{
		// templateMap の template に合わせて演出を選択
		const temp = myenv.templateMap[templateIndex];

		devMessage += "backgroundType = " + temp.backgroundType + "<br><br>";
		switch (temp.backgroundType) {
			case "default":
				p5.drawBackground();
				break;
			case "wave":
				p5.drawBackgroundWave();
				break;
			case "warp":
				p5.drawBackgroundWarp();
				break;
		}
		devMessage += "templateType   = " + temp.templateType + "<br><br>";
		switch (temp.templateType) {
			case "default":
				p5.drawCharDeco();
				p5.drawChar();
				break;
			case "songTitle":
				p5.drawTitle();
				break;
			case "songArtist":
				p5.drawArtist();
				break;
		}	
	};

	// ビートにあわせて背景を、発声にあわせて歌詞を表示
	p5.draw = () => {
		// プレイヤーが準備できていなかったら何もしない
		if (!player || !player.video) {
			return;
		}
		devMessage = "Debug Mode = ON <br><br>";
		const song = player.data.song;
		if(song){
			devMessage += "player.data.song.name        = " + song.name + "<br>";
			devMessage += "player.data.song.artist.name = " + song.artist.name + "<br>";
			devMessage += "player.data.song.permalink   = " + song.permalink + "<br><br>";
		}
		const position = player.timer.position;
		devMessage += "player.timer.position = " + position + "<br><br>";
		// templateMap の Index が範囲内であれば演出の処理を行う。
		devMessage += "templateIndex = " + templateIndex + "<br>";
		const temp = myenv.templateMap[templateIndex];
		devMessage += "indexType     = " + temp.indexType  + "<br>";
		devMessage += "startIndex    = " + temp.startIndex + "<br>";
		devMessage += "endIndex      = " + temp.endIndex  + "<br><br>";
		switch (temp.indexType){
			case "beat":
				const beat = player.findBeat(position);
				if (beat) {
					if (temp.startIndex <= beat.index) {
						p5.processTemplate();
					}
					if (temp.endIndex <= beat.index) {
						templateIndex++;
					}
				}
				break;
		}
		// DEBUG INFO PRINT
		if (myenv.devMode) {
			var debugInfo = document.getElementById("debugInfo");
			if(debugInfo == null){
				debugInfo = document.createElement('div');
				debugInfo.setAttribute("id", "debugInfo");
				document.body.appendChild(debugInfo);
				debugInfo.style.position = "absolute";
				debugInfo.style.left = 10;
				debugInfo.style.top = 50;
				debugInfo.overflow = "visible";
				debugInfo.style.fontSize = 9;
				debugInfo.style.fontFamily = "monospace";
				debugInfo.style.whiteSpace = "pre";
			}
			debugInfo.innerHTML = devMessage;
		}
	};
});
